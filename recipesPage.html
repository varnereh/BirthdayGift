<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Recipes</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <nav class="text-center">
        <a href="#">Home</a>
        <a href="#">Recipes</a>
        <a href="#">Description</a>
    </nav>

    <div class="container">
        <h1 class="my-4">All Recipes</h1>

        <!-- Recipe List (Dynamically Generated) -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="recipe-list">
            <!-- Recipes will be inserted here -->
        </div>

        <!-- Recipe Submission Form -->
        <div class="card mt-5 mx-auto" style="max-width: 500px;">
            <div class="card-body">
                <h2 class="card-title text-center">Submit a Recipe</h2>
                <form id="recipe-form">
                    <div class="mb-3">
                        <label for="recipe-name" class="form-label">Recipe Name:</label>
                        <input type="text" id="recipe-name" name="recipe-name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="recipe-description" class="form-label">Ingredients & Instructions:</label>
                        <textarea id="recipe-description" name="recipe-description" class="form-control" rows="5" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="recipe-images" class="form-label">Upload Images:</label>
                        <input type="file" id="recipe-images" name="recipe-images" class="form-control" multiple accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Submit Recipe</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Fetch and display recipes from a JSON file
        async function loadRecipes() {
            try {
                const response = await fetch('recipes.json'); 
                const recipes = await response.json();
                const recipeList = document.getElementById('recipe-list');

                recipes.forEach(recipe => {
                    const recipeItem = document.createElement('div');
                    recipeItem.classList.add('col');
                    recipeItem.innerHTML = `
                        <div class="card">
                            <img src="${recipe.image}" class="card-img-top" alt="${recipe.name}">
                            <div class="card-body text-center">
                                <a href="recipes/${recipe.filename}" class="card-title">${recipe.name}</a>
                            </div>
                        </div>
                    `;
                    recipeList.appendChild(recipeItem);
                });
            } catch (error) {
                console.error("Error loading recipes:", error);
            }
        }

        loadRecipes();

        // Handle form submission
        document.getElementById("recipe-form").addEventListener("submit", async function(event) {
            event.preventDefault();

            const name = document.getElementById("recipe-name").value;
            const description = document.getElementById("recipe-description").value;
            const imageInput = document.getElementById("recipe-images");
            const images = [];

            if (imageInput.files.length > 0) {
                for (let file of imageInput.files) {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    await new Promise(resolve => reader.onload = () => {
                        images.push(reader.result); // Convert image to base64
                        resolve();
                    });
                }
            }

            const issueTitle = `New Recipe: ${name}`;
            const issueBody = `**Recipe Name:** ${name}\n\n**Ingredients & Instructions:**\n${description}\n\n**Images:**\n${images.join("\n")}`;

            const githubToken = "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"; 
            const repoOwner = "varnereh"; 
            const repoName = "BirthdayGift"; 

            try {
                const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/issues`, {
                    method: "POST",
                    headers: {
                        "Authorization": `token ${githubToken}`,
                        "Accept": "application/vnd.github.v3+json"
                    },
                    body: JSON.stringify({
                        title: issueTitle,
                        body: issueBody,
                        labels: ["recipe-submission"]
                    })
                });

                if (response.ok) {
                    alert("Recipe submitted successfully!");
                    document.getElementById("recipe-form").reset();
                } else {
                    alert("Failed to submit recipe. Please try again.");
                }
            } catch (error) {
                console.error("Error submitting recipe:", error);
            }
        });
    </script>

</body>
</html>
